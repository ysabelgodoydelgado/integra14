<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>

    <record id="paperformat_advance_payment_list" model="report.paperformat">
        <field name="name">Formato de papel para Listado de anticipos</field>
        <field name="default" eval="True"/>
        <field name="format">custom</field>
        <!--<field name="page_height">210</field>
        <field name="page_width">297</field>-->
        <field name="orientation">Portrait</field>
        <field name="margin_top">5</field>
        <field name="margin_bottom">3</field>

        <field name="margin_left">3</field>
        <field name="margin_right">3</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">5</field>
        <field name="dpi">80</field>
    </record>
        <report
            id="binaural_anticipos.action_report_advance_payment_report"
            model="wizard.advance.payment.list"
            string="Listado de anticipos"
            menu="False"
            report_type="qweb-pdf"
            name="binaural_anticipos.advance_payment_template_report"
            file="binaural_anticipos.advance_payment_template_report"
            paperformat="paperformat_advance_payment_list"
            />
    <template id="binaural_anticipos.advance_payment_template_report">
            <t t-call="web.html_container">
		        <xpath expr="//t[@t-call='web.report_layout']" position="replace">
               
                    <div class="article" style="">
                    <t t-foreach="docs" t-as="d">
                            <div>
                                <div class="row">
                                    <div class="col-6 mb4">
                                        <img t-if="res_company.logo" t-att-src="image_data_uri(res_company.logo)"
                                            style="max-height:100px;width:200px;float:left"
                                            alt="Logo"/>
                                    </div>
                                    <div class="col-6 text-right" style="margin-top:22px;">
                                        <t t-if="date">
                                            <strong>Emisi√≥n :</strong>
                                            <span t-esc="date" t-options='{"widget": "date"}'/>
                                        </t>
                                    </div>
                                    
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <t t-if="d.type_payment">
                                            <t t-set="types" t-value="dict([('advance', 'Anticipos'),('payment', 'Pagos'),('is_expense', 'Gastos'),('all', 'Todos los pagos')])"/> <!--('discontinued', 'Suspendido')-->
                                            Tipo: <t t-esc="types[d.type_payment]"/>
                                            <br/>
                                        </t>
                                        <t t-if="d.at_today">

                                            Al: <span t-esc="d.end_date" t-options='{"widget": "date"}'/>
                                            <br/>
                                        </t>
                                        <t t-if="not d.at_today">
                                            Desde: <span t-esc="d.start_date" t-options='{"widget": "date"}'/>  Hasta:<span t-esc="d.start_date" t-options='{"widget": "date"}'/>
                                            <br/>
                                        </t>

                                    </div>
                                </div>
                                    <div class="row">
                                    <div class="col-12">
                                        <t t-if="res_company.name">
                                            <span t-esc="res_company.name"/>
                                            <br/>
                                        </t>
                                        <t t-if="res_company.vat">Rif:&amp;nbsp;
                                            <span t-esc="res_company.vat"/>
                                            <br/>
                                        </t>
                                    </div>
                                </div>
                                <h5 style="text-align:center" t-esc="name_report"></h5>    
		                        
		                    </div>

                       
		                    <div class="" style=" margin:0;padding:0">
		                        <style>
                                th{font-size:14px}
     td{padding:0px !important;vertical-align:top;text-align: center;font-size:12px;border:none !important;}
		                    tr { page-break-inside: avoid }
		                        </style>
                                <t t-set="total_by_all_partner" t-value="0"/>
                                <t t-set="residual_by_all_partner" t-value="0"/>
                                <t t-foreach="client_ids" t-as="o">
                                    <table class="table table-condensed">
                                        <tbody>
                                            <tr>
                                                <td colspan="2" style="text-align: left;">
			                                        <b><span t-esc="o.name"/></b>
                                                    <br/><!--Razon social-->
                                                    <b><span t-esc="o.prefix_vat"/>-<span t-esc="o.vat"/></b>
                                                    <br/>
		                                        </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <!--tabla de pagos-->
                                    <t t-set="pagos" t-value="d.get_payments_by_partner(o)"/>
                                    <table class="table table-condensed">
                                        <t>
                                            <tr>
                                                <th class="text-center">Fecha</th>
                                                <th class="text-center">Pago</th>
                                                <th class="text-center">Diario</th>
                                                <th class="text-center">Estado</th>
	                                            <th colspan="2"  class="text-center">Monto Original</th>
                                                <th colspan="2"  class="text-center">Monto Pagado</th>
                                                <th colspan="2"  class="text-center">Monto Disponible</th>
                                            </tr>
                                        </t>
                                        <tbody>
                                            <t t-set="total_by_partner" t-value="0"/>
                                            <t t-set="residual_by_partner" t-value="0"/>
                                            <tr  t-foreach="pagos" t-as="p">

                                                <td style="text-align: center">
			                                        <span t-esc="p.date" t-options='{"widget": "date"}'/>
		                                        </td>
                                                
                                                <td style="text-align: center">
			                                        <span t-esc="p.name"/>
		                                        </td>
                                                <td style="text-align: center">
			                                        <span t-esc="p.journal_id.name"/>
		                                        </td>
                                                <td style="text-align: center">
                                                    <t t-set="states_p" t-value="dict([('posted', 'Confirmado')])"/> <!--('discontinued', 'Suspendido')-->
                                                    <t t-esc="states_p[p.state]"/>
			                                        
                                                
		                                        </td>
	                                            <t t-if="p.currency_id.name == p.company_currency_id.name">
		                                            <td></td>
													<td colspan="2" style="text-align: right">
				                                        <span t-esc="p.amount" t-options='{"widget": "monetary", "display_currency": p.currency_id}'/>
			                                        </td>
	                                                <t t-set="residual" t-value="d.get_residual_by_payment(p)"/>
	                                                <td colspan="2" style="text-align: right">

				                                        <span t-esc="residual" t-options='{"widget": "monetary", "display_currency": p.currency_id}'/>
			                                        </td>
		                                            <t t-set="total_by_partner" t-value="total_by_partner+p.amount"/>
	                                            </t>
	                                            <t t-else="">
		                                            <td><span t-esc="p.amount" t-options='{"widget": "monetary", "display_currency": p.currency_id}'/></td>
		                                            <t t-set="amount_usd" t-value="p.amount/p.foreign_currency_rate"/>


													<td colspan="2" style="text-align: right">
				                                        <span t-esc="amount_usd" t-options='{"widget": "monetary", "display_currency": p.company_currency_id}'/>
			                                        </td>
	                                                <t t-set="residual" t-value="d.get_residual_by_payment(p)"/>
	                                                <td colspan="2" style="text-align: right">

				                                        <span t-esc="residual" t-options='{"widget": "monetary", "display_currency": p.company_currency_id}'/>
			                                        </td>
		                                            <t t-set="total_by_partner" t-value="total_by_partner+(p.amount/p.foreign_currency_rate)"/>
	                                            </t>


                                                <t t-set="residual_by_partner" t-value="residual_by_partner+residual"/>
                                                
                                            </tr> <!--pagos asociados-->
                                        <t>
                                            <tr>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
	                                            <th class="text-center"></th>
                                                <th class="text-center" colspan="2">Totales</th>
                                                <th colspan="2"  class="text-right" t-esc="total_by_partner" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'></th>
                                                <th colspan="2"  class="text-right" t-esc="residual_by_partner" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'></th>
                                            </tr>
                                        </t>
                                        </tbody>
                                        <t t-set="total_by_all_partner" t-value="total_by_all_partner+total_by_partner"/>
                                        <t t-set="residual_by_all_partner" t-value="residual_by_all_partner+residual_by_partner"/>
                                    </table>                                    
                                </t>    <!--client_ids-->  	

                                <table class="table table-condensed">
                                    <tbody>
                                        <t>
                                            <tr>
                                                
                                                <th class="text-center" style="visibility:hidden" >pppppppppp</th>
                                                <th class="text-center" style="visibility:hidden">ppppppppppppp</th>
                                                <th class="text-center" style="visibility:hidden">ppppppppppppp</th>
                                                <th class="text-center" style="visibility:hidden">ppppppppppppp</th>
                                                <th class="text-center" >Totales</th>
                                                <th colspan="2"  class="text-rigth" t-esc="total_by_all_partner" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'></th>
                                                <th colspan="2"  class="text-rigth" t-esc="residual_by_all_partner" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'></th>
                                            </tr>
                                        </t>	
                                        </tbody>
                                </table>                        	                     
		                    </div>
                    </t><!--docs-->
		            </div>
		        </xpath>
	        </t>
    </template>
    </data>
</odoo>
